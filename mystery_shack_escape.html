<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mystery Shack Escape</title>
<style>
  :root { color-scheme: dark; }
  body { background:#1a2b3c; color:#fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; margin:0; text-align:center; }
  h1 { font-weight:600; margin:16px 0 6px; }
  canvas { background:#87ceeb; display:block; margin:16px auto 24px; border:2px solid #4a2e1a; }
  .hint { opacity:.8; font-size:14px; margin-bottom:18px; }
</style>
</head>
<body>
<h1>Mystery Shack Escape</h1>
<div class="hint">Move: Arrow Keys or WASD. Jump: Spacebar or Up Arrow.</div>
<canvas id="gameCanvas" width="800" height="480" aria-label="Game canvas"></canvas>
<script>
'use strict';
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- Game Configuration ---
const GRAVITY = 0.5;
const JUMP_FORCE = -12;
const PLAYER_SPEED = 4;

// --- Game State ---
let player, platforms, keys;

function initGame(){
  player = { 
    x: 100, 
    y: 300, 
    width: 40, 
    height: 60, 
    dx: 0, 
    dy: 0, 
    onGround: false 
  };

  platforms = [
    // Ground
    { x: 0, y: 440, width: canvas.width, height: 40 },
    // Floating platforms
    { x: 200, y: 350, width: 100, height: 20 },
    { x: 350, y: 280, width: 100, height: 20 },
    { x: 500, y: 200, width: 100, height: 20 },
    { x: 650, y: 350, width: 150, height: 20 }
  ];

  keys = Object.create(null);
}

// --- Drawing ---
function drawPlayer() {
    // Simple Dipper-like character
    ctx.fillStyle = '#f2d4a9'; // Skin tone
    ctx.fillRect(player.x, player.y, player.width, player.height);
    // Hat
    ctx.fillStyle = '#0077be'; // Blue
    ctx.fillRect(player.x, player.y, player.width, 15);
    // Pine tree on hat
    ctx.fillStyle = '#ffffff';
    ctx.beginPath();
    ctx.moveTo(player.x + player.width / 2, player.y + 2);
    ctx.lineTo(player.x + player.width / 2 - 5, player.y + 12);
    ctx.lineTo(player.x + player.width / 2 + 5, player.y + 12);
    ctx.closePath();
    ctx.fill();
    // Vest
    ctx.fillStyle = '#3b4b61'; // Dark blue vest
    ctx.fillRect(player.x, player.y + 15, player.width, 30);
    // Shirt
    ctx.fillStyle = '#c93c20'; // Red shirt
    ctx.fillRect(player.x + 5, player.y + 15, player.width - 10, 30);
}

function drawPlatforms() {
    platforms.forEach(p => {
        ctx.fillStyle = '#228b22'; // Grassy green
        ctx.fillRect(p.x, p.y, p.width, p.height);
        ctx.fillStyle = '#8b4513'; // Dirt brown
        ctx.fillRect(p.x, p.y + 10, p.width, p.height - 10);
    });
}

// --- Updates ---
function updatePlayer() {
    // Horizontal movement
    player.dx = (keys['ArrowRight'] || keys['KeyD'] ? PLAYER_SPEED : 0) - (keys['ArrowLeft'] || keys['KeyA'] ? PLAYER_SPEED : 0);
    player.x += player.dx;

    // Vertical movement (Gravity)
    player.dy += GRAVITY;
    player.y += player.dy;
    player.onGround = false;

    // Collision with platforms
    for (const p of platforms) {
        if (player.x < p.x + p.width &&
            player.x + player.width > p.x &&
            player.y < p.y + p.height &&
            player.y + player.height > p.y) {
            
            // Check if landing on top
            if (player.dy > 0 && (player.y + player.height - player.dy) <= p.y) {
                player.y = p.y - player.height;
                player.dy = 0;
                player.onGround = true;
            }
        }
    }

    // Jumping
    if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.onGround) {
        player.dy = JUMP_FORCE;
        player.onGround = false;
    }

    // Prevent falling off screen bottom
    if (player.y + player.height > canvas.height) {
        player.y = canvas.height - player.height;
        player.dy = 0;
        player.onGround = true;
    }

    // Prevent moving off screen sides
    player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
}

// --- Controls ---
addEventListener('keydown', e => {
    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) e.preventDefault();
    keys[e.code] = true;
});
addEventListener('keyup', e => { keys[e.code] = false; });

// --- Main Loop ---
function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    drawPlatforms();
    drawPlayer();

    updatePlayer();

    requestAnimationFrame(loop);
}

initGame();
requestAnimationFrame(loop);
</script>
</body>
</html>